# Testing Issues: Story 1.14 Remove Member Flow

**Date:** 2025-12-07
**Tested by:** Claude (Playwright MCP dual browser testing)
**Story:** 1.14 - Remove Family Member & Self De-registration

---

## Test Results Summary

| AC | Description | Status | Notes |
|---|---|---|---|
| AC1 | Remove Member UI | PASS | "Remove" button visible next to non-admin members |
| AC2 | Remove Member Backend | PASS | Membership deleted, user redirected to /family-setup |
| AC3 | Admin Protection | NOT TESTED | Requires second admin user |
| AC4 | Allow Re-invite | PASS | Email invite sent and accepted successfully |
| AC5 | Cleanup | NOT TESTED | Requires DB inspection for pending invites |

---

## Issues Found

### Issue 1: Member count shows "0 members" after rejoin

- **Severity:** Low (cosmetic)
- **Component:** Frontend
- **Status:** Open

**Description:**
After a removed member accepts a re-invite and rejoins the family, the header displays "0 members" instead of the correct count.

**Expected:**
Should show correct member count (e.g., "2 members")

**Steps to Reproduce:**
1. Admin removes member from family
2. Admin sends email invite to removed member
3. Member accepts invite via /accept-invite?code=...
4. Member is in chat, but header shows "0 members"

**Notes:**
Likely a cache/refetch issue after accept-invite mutation. Doesn't affect functionality.

---

### Issue 2: Accept invite logs error but succeeds

- **Severity:** Low (UX/logging)
- **Component:** Frontend
- **Status:** Open

**Description:**
When accepting an invite, console shows an error log but the operation actually succeeds.

**Expected:**
No error log if operation succeeds, or error should cause visible failure.

**Console/Logs:**
```
[ERROR] Accept invite error: Error
[KeyCheck] userId: ... hasUserKey: true hasFamilyKey: true
```

**Notes:**
May be a race condition in error handling - the mutation might throw during one phase but complete successfully. User ends up in the family correctly despite the error log.

---

### Issue 3: Family-setup "Join Family" confusing for existing users

- **Severity:** Low (UX clarity)
- **Component:** Frontend
- **Status:** Open

**Description:**
The `/family-setup` page's "Join Family" tab uses the `joinFamily` mutation which expects NEW users (email, name, password, publicKey). Existing logged-in users who try to use the static invite code here get a generic "Failed to join family" error with no guidance.

**Expected:**
Either:
- Clear message explaining existing users should use email invite link
- Or automatic redirect to accept-invite flow for logged-in users
- Or the tab should work for existing users too

**Steps to Reproduce:**
1. User A creates family, removes User B
2. User B is redirected to /family-setup (still logged in)
3. User B clicks "Join Family" tab
4. User B enters static invite code (e.g., FAMILY-ABC123...)
5. User B clicks "Join Family" button
6. Error toast: "Failed to join family"

**Notes:**
Correct flow for existing users: must use email invite link (`/accept-invite?code=...`). The static invite code on family-setup is designed for NEW user registration flow.
